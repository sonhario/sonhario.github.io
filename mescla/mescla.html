<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Três Modos Alternáveis - Diagnóstico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/addons/p5.sound.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            cursor: none;
        }
        
        .mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26,26,46,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
        }

        .mode-indicator2 {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(26,26,46,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
        }

        .mode-indicator3 {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(26,26,46,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
        }
        
        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            color: black;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
            max-width: 80%;
            white-space: pre-line;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a2e;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            font-family: 'Courier New', monospace;
        }

        .error-list {
            color: #ff6b6b;
            margin-top: 20px;
            text-align: left;
            max-width: 80%;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <h2>Diagnóstico de Carregamento</h2>
        <div id="loadingProgress">Verificando recursos...</div>
        <div class="error-list" id="errorList"></div>
        <div style="margin-top: 20px; font-size: 12px;">
            Pressione F12 para ver console detalhado
        </div>
    </div>

    <div class="mode-indicator" id="modeIndicator">[diagnóstico] > X</div>
    <div class="mode-indicator2" id="modeIndicator2">[sonhos] > S / M </div>
    <div class="mode-indicator3" id="modeIndicator3">[sons] > A </div>
    <div class="debug-info" id="debugInfo">Iniciando diagnóstico...</div>
    
    <script>
        // ===========================================
        // DIAGNÓSTICO DETALHADO
        // ===========================================
        let diagnosticLog = [];
        let resourceErrors = [];
        let loadingProgress = 0;
        let totalResources = 0;
        let loadedResources = 0;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            diagnosticLog.push(logEntry);
            console.log(logEntry);
            updateDiagnosticDisplay();
        }

        function logError(message) {
            resourceErrors.push(message);
            log(`ERRO: ${message}`);
            updateErrorDisplay();
        }

        function updateDiagnosticDisplay() {
            const debugDiv = document.getElementById('debugInfo');
            if (debugDiv) {
                debugDiv.textContent = diagnosticLog.slice(-5).join('\n');
            }
        }

        function updateErrorDisplay() {
            const errorDiv = document.getElementById('errorList');
            const progressDiv = document.getElementById('loadingProgress');
            
            if (errorDiv) {
                errorDiv.innerHTML = resourceErrors.map(err => `• ${err}`).join('<br>');
            }
            
            if (progressDiv) {
                progressDiv.textContent = `Carregado: ${loadedResources}/${totalResources} recursos`;
            }
        }

        // ===========================================
        // MODO APENAS PALAVRAS (SEM RECURSOS EXTERNOS)
        // ===========================================
        let currentAppMode = 'palavras';
        let conceptBoxes = [];
        let centerBox;
        let canvasWidth, canvasHeight;

        // Lista de conceitos (funciona sempre)
        const allConcepts = [
            "inteligência", "artificial", "sonhos", "espectros", "memória", "arquivo",
            "tempo", "anacronia", "vestígio", "bio", "tecno", "conjurar", "extinção",
            "vida", "morte", "registro", "experiência", "pensamento", "transformação",
            "real", "abstração", "afeto", "ciência", "objeto", "presença", "ausência"
        ];

        // Textos (funciona sempre)
        const shortTexts = [
            `sonho = espectro?

sonho pertence ao 
conjunto dos espectros?
/
>> sonhar é conjurar espectros?`,

            `o pensamento continua depois 
da (extinção da) humanidade?
/
o sonho continua depois 
da (extinção da) humanidade?`,

            `[ órgãos sensoriais não fisiológicos ]
IAs simulam órgãos sensoriais?
Sonhos simulam órgãos sensoriais?`
        ];

        let currentTextIndex = 0;
        let textBackgroundColor;
        let textFontColor;

        // ===========================================
        // TESTE DE RECURSOS (SEM CARREGAR)
        // ===========================================
        async function testResources() {
            log("Iniciando teste de recursos...");
            
            // Lista de recursos para testar
            const imageFiles = ['1.jpg', '2.jpg', '3.jpg', '4.jpg', '5.jpg'];
            const soundFiles = ['1.wav', '2.wav', 'som.wav'];
            const videoFiles = ['out.mp4'];
            
            totalResources = imageFiles.length + soundFiles.length + videoFiles.length;
            
            // Testar imagens
            log("Testando imagens...");
            for (let file of imageFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        log(`✓ Imagem encontrada: ${file}`);
                        loadedResources++;
                    } else {
                        logError(`✗ Imagem não encontrada: ${file} (${response.status})`);
                    }
                } catch (err) {
                    logError(`✗ Erro ao acessar imagem: ${file} - ${err.message}`);
                }
                updateErrorDisplay();
                await new Promise(resolve => setTimeout(resolve, 100)); // Pequeno delay
            }
            
            // Testar sons
            log("Testando sons...");
            for (let file of soundFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        log(`✓ Som encontrado: ${file}`);
                        loadedResources++;
                    } else {
                        logError(`✗ Som não encontrado: ${file} (${response.status})`);
                    }
                } catch (err) {
                    logError(`✗ Erro ao acessar som: ${file} - ${err.message}`);
                }
                updateErrorDisplay();
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // Testar vídeo
            log("Testando vídeo...");
            for (let file of videoFiles) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        log(`✓ Vídeo encontrado: ${file}`);
                        loadedResources++;
                    } else {
                        logError(`✗ Vídeo não encontrado: ${file} (${response.status})`);
                    }
                } catch (err) {
                    logError(`✗ Erro ao acessar vídeo: ${file} - ${err.message}`);
                }
                updateErrorDisplay();
            }
            
            log(`Diagnóstico completo: ${loadedResources}/${totalResources} recursos disponíveis`);
            
            // Aguardar um pouco e então iniciar o modo seguro
            setTimeout(startSafeMode, 2000);
        }

        function startSafeMode() {
            log("Iniciando modo seguro (apenas palavras e textos)...");
            document.getElementById('loadingScreen').style.display = 'none';
        }

        // ===========================================
        // SETUP SEM PRELOAD
        // ===========================================
        function setup() {
            log("Setup iniciado...");
            
            canvasWidth = windowWidth;
            canvasHeight = windowHeight;
            createCanvas(canvasWidth, canvasHeight);
            
            initializePalavras();
            
            log("Canvas criado, iniciando modo palavras...");
            updateModeIndicator();
        }

        function initializePalavras() {
            conceptBoxes = [];
            
            centerBox = {
                text: "sonhos",
                textSize: 14,
                padding: 12,
                cornerRadius: 8
            };
            
            let initialMarginX = canvasWidth * 0.05;
            let initialMarginY = canvasHeight * 0.05;
            
            for (let i = 0; i < allConcepts.length; i++) {
                if (allConcepts[i] !== "sonhos") {
                    conceptBoxes.push(createConceptBox(allConcepts[i], initialMarginX, initialMarginY));
                }
            }
            
            log(`Modo palavras: ${conceptBoxes.length} conceitos criados`);
        }

        function createConceptBox(conceptText, marginX, marginY) {
            return {
                x: random(marginX, canvasWidth - marginX),
                y: random(marginY, canvasHeight - marginY),
                text: conceptText,
                textSize: 14,
                padding: 12,
                cornerRadius: 8
            };
        }

        function initializeTextos() {
            currentTextIndex = floor(random(shortTexts.length));
            textBackgroundColor = color(random(255), random(255), random(255));
            textFontColor = color(random(255), random(255), random(255));
            log(`Modo textos: texto ${currentTextIndex + 1} selecionado`);
        }

        // ===========================================
        // DRAW FUNCTIONS
        // ===========================================
        function draw() {
            try {
                if (currentAppMode === 'palavras') {
                    drawPalavras();
                } else if (currentAppMode === 'textos') {
                    drawTextos();
                }
            } catch (error) {
                logError(`Erro no draw: ${error.message}`);
            }
        }

        function drawPalavras() {
            background(26, 26, 46);
            
            // Desenhar conceitos
            for (let concept of conceptBoxes) {
                drawConceptBox(concept, concept.x, concept.y);
            }
            
            // Desenhar conceito central
            drawConceptBox(centerBox, mouseX, mouseY);
        }

        function drawTextos() {
            background(textBackgroundColor);
            
            push();
            fill(textFontColor);
            noStroke();
            textFont('Courier New');
            textSize(32);
            textAlign(CENTER, CENTER);
            
            text(shortTexts[currentTextIndex], width/2, height/2);
            pop();
        }

        function drawConceptBox(box, x, y) {
            push();
            textSize(box.textSize);
            textFont('Courier New');
            
            let textW = textWidth(box.text);
            let boxWidth = textW + box.padding * 2;
            let boxHeight = box.textSize + box.padding * 2;
            
            stroke(255);
            strokeWeight(1);
            noFill();
            rect(x - boxWidth/2, y - boxHeight/2, boxWidth, boxHeight, box.cornerRadius);
            
            fill(255);
            noStroke();
            textAlign(CENTER, CENTER);
            text(box.text, x, y);
            pop();
        }

        // ===========================================
        // CONTROLES
        // ===========================================
        function keyPressed() {
            if (key === 'x' || key === 'X') {
                if (currentAppMode === 'palavras') {
                    currentAppMode = 'textos';
                    initializeTextos();
                } else {
                    currentAppMode = 'palavras';
                }
                updateModeIndicator();
                log(`Modo alterado para: ${currentAppMode}`);
            }
        }

        function mousePressed() {
            if (currentAppMode === 'palavras') {
                // Trocar conceito central
                let randomIndex = Math.floor(random(conceptBoxes.length));
                let newCenterConcept = conceptBoxes[randomIndex];
                
                let returnedConcept = createConceptBox(centerBox.text, canvasWidth * 0.05, canvasHeight * 0.05);
                returnedConcept.x = mouseX + random(-100, 100);
                returnedConcept.y = mouseY + random(-100, 100);
                
                conceptBoxes[randomIndex] = returnedConcept;
                centerBox.text = newCenterConcept.text;
                
                log(`Conceito central alterado para: ${centerBox.text}`);
            }
        }

        function updateModeIndicator() {
            const indicator = document.getElementById('modeIndicator');
            if (indicator) {
                indicator.textContent = `[${currentAppMode}] > X <`;
            }
        }

        function windowResized() {
            canvasWidth = windowWidth;
            canvasHeight = windowHeight;
            resizeCanvas(canvasWidth, canvasHeight);
            log("Canvas redimensionado");
        }

        // ===========================================
        // INICIALIZAÇÃO
        // ===========================================
        window.addEventListener('load', function() {
            log("Página carregada, iniciando diagnóstico...");
            testResources();
        });

        // Iniciar diagnóstico imediatamente
        log("Script carregado, aguardando p5.js...");
    </script>
</body>
</html>
